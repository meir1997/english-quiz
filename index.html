<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>אוצר מילים באנגלית</title>
  <style>
    :root {
      --main-font-size: 1em;
      --option-font-size: 1em;
      --button-font-size: 1em;
      --main-padding: 8px 0;
      --option-width: 100%;
      --option-height: 60px;
      --option-margin: 18px auto;
      --option-max-width: 420px;
      --main-max-width: 500px;
    }
    body { direction: rtl; font-family: Arial, sans-serif; background: #fafafa; font-size: var(--main-font-size); }
    #main-content { max-width: var(--main-max-width); margin: 40px auto; text-align: center; padding: 0 1vw; }
    #menu-bar { margin: 28px 0; }
    #menu-bar button { margin: 0 8px; padding: 12px 28px; font-size: var(--button-font-size); border-radius: 12px; border: none; background: #eee; cursor: pointer; }
    #menu-bar button:hover { background: #d0eaff; }
    #options {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 72px;
      width: 100%;
      margin: 0 auto 18px auto;
    }
    .option {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: var(--option-height);
      margin: 0 0 18px 0;
      padding: var(--main-padding);
      font-size: var(--option-font-size);
      border-radius: 12px;
      border: 1.2px solid #ccc;
      background: #f5f5f5;
      cursor: pointer;
      text-align: center;
      line-height: normal;
      transition: box-shadow 0.2s;
      box-sizing: border-box;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .option:hover {
      background: #e0f7fa;
      box-shadow: 0 2px 8px #0001;
    }
    .word-number { display: block; font-size: 1.5em; color: #888; margin-bottom: 0.2em; }
    .word-main {
      display: block;
      font-size: var(--option-font-size);
      font-weight: bold;
    }
    .arrows-bar { margin: 24px 0 0 0; display: flex; justify-content: center; gap: 12px; }
    .arrow-btn { font-size: var(--button-font-size); padding: 10px 16px; border-radius: 8px; border: 1.2px solid #bbb; background: #f0f0f0; margin: 0 4px; min-width: 40px; cursor: pointer; }
    .arrow-btn:active { background: #d0eaff; }
    #feedback {
      margin: 18px;
      font-size: var(--main-font-size);
      min-height: 2.5em;
    }
    #score { font-weight: bold; font-size: var(--main-font-size); }
    h1, h2 { font-size: calc(var(--main-font-size) * 1.5); }
    @media (max-width: 700px), (max-width: 600px) {
      .word-main {
        margin-top: 90vh;
      }
      .word-number {
        font-size: 2.5em;
      }
    }
  </style>
</head>
<body>
  <div id="main-content">טוען...</div>
  <button id="home-btn" style="position:fixed;top:20px;left:20px;z-index:1000;padding:10px 18px;font-size:1.1em;border-radius:8px;border:none;background:#e0f7fa;cursor:pointer;">דף הבית</button>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

    const APP_VERSION = "31.8";

    const firebaseConfig = {
      apiKey: "AIzaSyDVRxq8xDuZbF7Jxyz74qMQzGj09zIjhhU",
      authDomain: "vocab-app-meir.firebaseapp.com",
      projectId: "vocab-app-meir",
      storageBucket: "vocab-app-meir.appspot.com",
      messagingSenderId: "71704465708",
      appId: "1:71704465708:web:e5aed9325adf4979b89c89",
      measurementId: "G-ZVCT2T78ZT"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;

    // משתנים גלובליים
    let quizWords = [];
    let words = [];
    let learnedWords = [];
    let appearedWords = [];
    let score = 0;
    let current = 0;
    let hasLoadedCloudProgress = false;

    // פונקציות גיבוי ושחזור
    window.saveProgressToCloud = async function() {
      try {
        if (!currentUser) {
          alert('יש להתחבר לפני גיבוי!');
          showAuthForm();
          return;
        }
        const userId = currentUser.uid; // שימוש ב-uid של המשתמש המחובר
        localStorage.setItem('vocabUserId', userId); // שמור את שם המשתמש
        const data = {
          vocabScore: localStorage.getItem('vocabScore') || '0',
          learnedWords: localStorage.getItem('learnedWords') || '[]',
          appearedWords: localStorage.getItem('appearedWords') || '[]',
          timestamp: new Date().toISOString()
        };
        console.log('מנסה לשמור נתונים:', data);
        await setDoc(doc(db, "users", userId), data);
        alert("ההתקדמות נשמרה בענן בהצלחה!");
        console.log('הנתונים נשמרו בהצלחה');
        updateVersionIndicator(); // עדכן תצוגה
      } catch (error) {
        console.error('שגיאה בשמירת נתונים:', error);
        alert(`שגיאה בשמירת הנתונים: ${error.message}\n\nנסה לפתוח את האפליקציה בשרת מקומי או לבדוק את חיבור האינטרנט`);
      }
    }

    window.loadProgressFromCloud = async function() {
      try {
        if (!currentUser) {
          alert('יש להתחבר לפני שחזור!');
          showAuthForm();
          return;
        }
        const userId = currentUser.uid; // שימוש ב-uid של המשתמש המחובר
        console.log('מנסה לטעון נתונים עבור:', userId);
        const docSnap = await getDoc(doc(db, "users", userId));
        if (docSnap.exists()) {
          const data = docSnap.data();
          console.log('נתונים שנטענו:', data);
          localStorage.setItem('vocabScore', data.vocabScore || '0');
          localStorage.setItem('learnedWords', data.learnedWords || '[]');
          localStorage.setItem('appearedWords', data.appearedWords || '[]');
          alert("ההתקדמות שוחזרה מהענן בהצלחה!");
          console.log('הנתונים שוחזרו בהצלחה');
          updateVersionIndicator(); // עדכן תצוגה
          location.reload();
        } else {
          alert("לא נמצאה התקדמות עבור משתמש זה.\n\nאם זה הפעם הראשונה שלך, לחץ על 'גיבוי לענן' כדי לשמור את ההתקדמות שלך.");
        }
      } catch (error) {
        console.error('שגיאה בטעינת נתונים:', error);
        alert(`שגיאה בטעינת הנתונים: ${error.message}\n\nנסה לפתוח את האפליקציה בשרת מקומי או לבדוק את חיבור האינטרנט`);
      }
    }

    // טופס הרשמה/התחברות
    function showAuthForm() {
      document.getElementById('main-content').innerHTML = `
        <h2>התחברות / הרשמה</h2>
        <form id="auth-form" style="max-width:340px;margin:0 auto;text-align:center;">
          <input id="email" type="email" placeholder="אימייל" required style="width:90%;margin:8px 0;padding:10px;font-size:1em;"/><br/>
          <input id="password" type="password" placeholder="סיסמה" required style="width:90%;margin:8px 0;padding:10px;font-size:1em;"/><br/>
          <button id="login-btn" type="button" style="margin:8px;padding:10px 24px;">התחבר</button>
          <button id="register-btn" type="button" style="margin:8px;padding:10px 24px;">הרשמה</button>
        </form>
        <div id="auth-error" style="color:red;margin-top:10px;"></div>
        <button id="back-btn">חזור</button>
        <div id="version-indicator" style="position:fixed;bottom:10px;left:10px;font-size:0.8em;color:#888;z-index:1000;"></div>
      `;
      document.getElementById('login-btn').onclick = async () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (e) {
          document.getElementById('auth-error').textContent = e.message;
        }
      };
      document.getElementById('register-btn').onclick = async () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        try {
          await createUserWithEmailAndPassword(auth, email, password);
        } catch (e) {
          document.getElementById('auth-error').textContent = e.message;
        }
      };
      document.getElementById('back-btn').onclick = goHome;
      updateVersionIndicator();
    }

    // עדכון תצוגת גרסה + משתמש
    function updateVersionIndicator() {
      const mode = localStorage.getItem('viewMode') === 'mobile' ? 'טלפון' : 'מחשב';
      let userStr = 'לא מחובר';
      if (currentUser) {
        userStr = currentUser.email || currentUser.uid;
      }
      document.getElementById('version-indicator').textContent = `גרסה ${APP_VERSION} — תצוגת ${mode} — משתמש: ${userStr}`;
    }

    // דף הבית
    function goHome() {
      let userStr = 'לא מחובר';
      if (currentUser) userStr = currentUser.email || currentUser.uid;
      let html = `
        <h1>אוצר מילים באנגלית</h1>
        <div id="score">ניקוד: ${parseInt(localStorage.getItem('vocabScore') || '0', 10)}</div>
        <div id="options">
          <button id="start-quiz-btn" class="option">התחל תרגול</button>
          <button id="unknown-btn" class="option">למד מילים שלא ידעתי</button>
          <button id="learned-btn" class="option">מילים שלמדתי</button>
          <button id="all-words-btn" class="option">רשימת כל המילים</button>
          <button id="backup-btn" class="option">גיבוי לענן</button>
          <button id="restore-btn" class="option">שחזור מהענן</button>
          <button id="test-connection-btn" class="option" style="background-color: #fff3cd;">בדיקת חיבור</button>
        </div>
        <button id="settings-btn" style="margin:18px auto 0 auto;display:block;padding:10px 24px;font-size:1em;border-radius:10px;background:#f8f8f8;">הגדרות</button>
        <div id="settings-panel" style="display:none;margin:20px auto 0 auto;max-width:400px;text-align:center;background:#f8f8f8;padding:18px 0;border-radius:12px;box-shadow:0 2px 8px #0001;">
          <div style="font-size:1.1em;margin-bottom:10px;">בחר תצוגה:</div>
          <button id="view-mobile" style="margin:0 8px;padding:8px 18px;font-size:1em;border-radius:8px;">תצוגת טלפון</button>
          <button id="view-desktop" style="margin:0 8px;padding:8px 18px;font-size:1em;border-radius:8px;">תצוגת מחשב</button>
        </div>
        <div style="margin:18px 0 0 0;">
          <span id="user-indicator" style="font-size:0.95em;color:#555;">משתמש: ${userStr}</span>
          ${currentUser ? '<button id="logout-btn" style="margin-right:12px;padding:6px 18px;font-size:0.95em;border-radius:8px;">התנתק</button>' : '<button id="login-btn" style="margin-right:12px;padding:6px 18px;font-size:0.95em;border-radius:8px;">התחבר/הרשם</button>'}
        </div>
        <div id="version-indicator" style="position:fixed;bottom:10px;left:10px;font-size:0.8em;color:#888;z-index:1000;"></div>
      `;
      document.getElementById('main-content').innerHTML = html;
      document.getElementById('start-quiz-btn').onclick = startQuiz;
      document.getElementById('unknown-btn').onclick = startUnknownQuiz;
      document.getElementById('learned-btn').onclick = showLearnedWords;
      document.getElementById('all-words-btn').onclick = showAllWords;
      document.getElementById('backup-btn').onclick = () => {
        if (!currentUser) {
          alert('יש להתחבר לפני גיבוי!');
          showAuthForm();
          return;
        }
        saveProgressToCloud();
      };
      document.getElementById('restore-btn').onclick = () => {
        if (!currentUser) {
          alert('יש להתחבר לפני שחזור!');
          showAuthForm();
          return;
        }
        loadProgressFromCloud();
      };
      document.getElementById('test-connection-btn').onclick = window.testFirebaseConnection;
      document.getElementById('settings-btn').onclick = () => {
        const panel = document.getElementById('settings-panel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
      };
      document.getElementById('view-mobile').onclick = () => {
        localStorage.setItem('viewMode', 'mobile');
        applyViewMode();
        goHome();
        updateVersionIndicator();
      };
      document.getElementById('view-desktop').onclick = () => {
        localStorage.setItem('viewMode', 'desktop');
        applyViewMode();
        goHome();
        updateVersionIndicator();
      };
      if (currentUser) {
        document.getElementById('logout-btn').onclick = async () => {
          await signOut(auth);
        };
      } else {
        document.getElementById('login-btn').onclick = showAuthForm;
      }
      updateVersionIndicator();
    }

    // מעקב אחרי התחברות/התנתקות
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      goHome();
    });

    // שאר הקוד (פונקציות quiz וכו') נשארות כמו שהן, רק ודא שקריאות לגיבוי/שחזור עוברות דרך goHome

    document.getElementById('home-btn').onclick = () => location.reload();

    // הפעל את דף הבית ברגע שהכל נטען
    goHome();

    // הפעל את מצב התצוגה שנבחר (אם קיים)
    applyViewMode();
    updateVersionIndicator();

    // עדכן גם אחרי כל טעינה מחדש
    document.addEventListener('DOMContentLoaded', () => {
      applyViewMode();
      updateVersionIndicator();
    });

    function applyViewMode() {
      const mode = localStorage.getItem('viewMode');
      const style = document.documentElement.style;
      document.body.classList.remove('mobile-view', 'desktop-view');
      if (mode === 'mobile') {
        style.setProperty('--main-font-size', '1.5em');
        style.setProperty('--option-font-size', '3.3em');
        style.setProperty('--button-font-size', '1.5em');
        style.setProperty('--main-padding', '8px 0');
        style.setProperty('--option-width', '100%');
        style.setProperty('--option-height', '120px');
        style.setProperty('--option-margin', '18px auto');
        style.setProperty('--option-max-width', '98vw');
        style.setProperty('--main-max-width', '98vw');
        document.body.classList.add('mobile-view');
      } else {
        style.setProperty('--main-font-size', '1em');
        style.setProperty('--option-font-size', '1em');
        style.setProperty('--button-font-size', '1em');
        style.setProperty('--main-padding', '8px 0');
        style.setProperty('--option-width', '100%');
        style.setProperty('--option-height', '60px');
        style.setProperty('--option-margin', '18px auto');
        style.setProperty('--option-max-width', '420px');
        style.setProperty('--main-max-width', '500px');
        document.body.classList.add('desktop-view');
      }
    }

    function showAllWords(filter = 'all', searchTerm = '') {
      learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
      appearedWords = JSON.parse(localStorage.getItem('appearedWords') || '[]');
      let filtered = quizWords;
      if (filter === 'known') filtered = quizWords.filter(w => learnedWords.includes(w.word));
      if (filter === 'unknown') filtered = quizWords.filter(w => appearedWords.includes(w.word) && !learnedWords.includes(w.word));
      if (filter === 'not-seen') filtered = quizWords.filter(w => !appearedWords.includes(w.word) && !learnedWords.includes(w.word));
      if (searchTerm) {
        const term = searchTerm.trim().toLowerCase();
        filtered = filtered.filter(w => w.word.toLowerCase().includes(term));
      }
      let html = `<h2>רשימת כל המילים</h2>
        <div>
          <button id="filter-all">הכל</button>
          <button id="filter-known">שלמדתי</button>
          <button id="filter-unknown">שלא ידעתי</button>
          <button id="filter-not-seen">שטרם הופיעו</button>
        </div>
        <input id="search-word-list" type="text" placeholder="חפש מילה..." style="margin:14px 0 10px 0;padding:8px;width:70%;font-size:1em;direction:rtl;text-align:right;border-radius:8px;border:1px solid #ccc;" />
        <ul id="words-list-ul" style="list-style:none;padding:0;text-align:right;direction:rtl;">
      `;
      html += filtered.map(w => {
        let status = learnedWords.includes(w.word) ? '✔️' : (appearedWords.includes(w.word) ? '❌' : '⏳');
        return `<li style="margin-bottom:6px;">${w.word} ${status}</li>`;
      }).join('') + '</ul>';
      html += `<button id="back-btn">חזור</button> <button id="scroll-top-btn">חזור למעלה</button>`;
      document.getElementById('main-content').innerHTML = html;
      // שמור ערך חיפוש קיים
      const searchInput = document.getElementById('search-word-list');
      searchInput.value = searchTerm;
      // searchInput.focus(); // הסר פוקוס אוטומטי כדי לאפשר הקלדה תקינה
      document.getElementById('back-btn').onclick = goHome;
      document.getElementById('filter-all').onclick = () => showAllWords('all', searchInput.value);
      document.getElementById('filter-known').onclick = () => showAllWords('known', searchInput.value);
      document.getElementById('filter-unknown').onclick = () => showAllWords('unknown', searchInput.value);
      document.getElementById('filter-not-seen').onclick = () => showAllWords('not-seen', searchInput.value);
      document.getElementById('scroll-top-btn').onclick = () => window.scrollTo({top:0,behavior:'smooth'});
      searchInput.oninput = (e) => showAllWords(filter, e.target.value);
      updateVersionIndicator();
    }

    function startQuiz() {
      // למידה לפי סדר, רק מילים שטרם נלמדו ושטרם הופיעו
      learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
      appearedWords = JSON.parse(localStorage.getItem('appearedWords') || '[]');
      words = quizWords.filter(w => !learnedWords.includes(w.word) && !appearedWords.includes(w.word));
      // מיין לפי מספר המילה (בהנחה שהפורמט הוא "מספר. מילה")
      words.sort((a, b) => {
        // חילוץ מספר המילה בצורה בטוחה
        const numA = parseInt((a.word.match(/^\s*(\d+)/) || [0,0])[1], 10);
        const numB = parseInt((b.word.match(/^\s*(\d+)/) || [0,0])[1], 10);
        return numA - numB;
      });
      score = parseInt(localStorage.getItem('vocabScore') || '0', 10);
      current = 0;
      showQuestion();
    }

    function startUnknownQuiz() {
      learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '0');
      appearedWords = JSON.parse(localStorage.getItem('appearedWords') || '[]');
      const unknown = quizWords.filter(w => appearedWords.includes(w.word) && !learnedWords.includes(w.word));
      if (unknown.length === 0) {
        document.getElementById('main-content').innerHTML = '<h2>אין מילים שלא ידעת!</h2><button id="back-btn">חזור</button>';
        document.getElementById('back-btn').onclick = goHome;
        return;
      }
      // הצג לפי סדר מספרי בלבד
      words = [...unknown];
      words.sort((a, b) => {
        // חילוץ מספר המילה בצורה בטוחה
        const numA = parseInt((a.word.match(/^\s*(\d+)/) || [0,0])[1], 10);
        const numB = parseInt((b.word.match(/^\s*(\d+)/) || [0,0])[1], 10);
        return numA - numB;
      });
      score = parseInt(localStorage.getItem('vocabScore') || '0', 10);
      current = 0;
      showQuestion();
    }

    function showLearnedWords() {
      learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
      let filteredLearned = quizWords.filter(w => learnedWords.includes(w.word));
      let html = `<h2>מילים שלמדת</h2>`;
      if (filteredLearned.length === 0) {
        html += '<div>לא נמצאו מילים שלמדת</div>';
      } else {
        html += '<ul style="list-style:none;padding:0;">' +
          filteredLearned.map(w => `<li>${w.word} ✔️</li>`).join('') + '</ul>';
      }
      html += `<button id="back-btn">חזור</button>`;
      document.getElementById('main-content').innerHTML = html;
      document.getElementById('back-btn').onclick = goHome;
      updateVersionIndicator();
    }

    function showQuestion() {
      if (current >= words.length) {
        document.getElementById('main-content').innerHTML = `<h2>סיימת את כל המילים!</h2><div id="score">ניקוד: ${score}</div><button id="back-btn">חזור</button>`;
        document.getElementById('back-btn').onclick = goHome;
        return;
      }
      const w = words[current];
      // שמור הופעה של מילה ב-localStorage
      let appearedWords = JSON.parse(localStorage.getItem('appearedWords') || '[]');
      if (!appearedWords.includes(w.word)) {
        appearedWords.push(w.word);
        localStorage.setItem('appearedWords', JSON.stringify(appearedWords));
      }
      let html = `<span class="word-number">${w.word.split('.')[0]}</span><span class="word-main">${w.word.replace(/^\s*\d+\.\s*/, '')}</span>`;
      html += `
        <div id="options"></div>
        <div id="feedback"></div>
        <div id="score">ניקוד: ${score}</div>
        <div class="arrows-bar">
          <button id="prev100-btn" class="arrow-btn">⬅️ 100</button>
          <button id="prev-btn" class="arrow-btn">⬅️</button>
          <span style="font-size:0.7em;align-self:center;">${current + 1} / ${words.length}</span>
          <button id="next-btn" class="arrow-btn">➡️</button>
          <button id="next100-btn" class="arrow-btn">100 ➡️</button>
        </div>
        <div id="version-indicator" style="position:fixed;bottom:10px;left:10px;font-size:0.8em;color:#888;z-index:1000;"></div>
      `;
      document.getElementById('main-content').innerHTML = html;
      const optionsDiv = document.getElementById('options');
      optionsDiv.style.display = 'flex';
      optionsDiv.style.flexDirection = 'column';
      optionsDiv.style.alignItems = 'center';
      w.options.forEach(option => {
        const btn = document.createElement('button');
        btn.textContent = option;
        btn.className = 'option';
        btn.onclick = () => {
          if (option === w.correct) {
            document.getElementById('feedback').textContent = 'נכון!';
            score++;
            localStorage.setItem('vocabScore', score);
            // הוספת המילה ל-learnedWords אם לא קיימת
            let learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '[]');
            if (!learnedWords.includes(w.word)) {
              learnedWords.push(w.word);
              localStorage.setItem('learnedWords', JSON.stringify(learnedWords));
            }
            // הסר את המילה מ-appearedWords אם קיימת
            let appearedWords2 = JSON.parse(localStorage.getItem('appearedWords') || '[]');
            if (appearedWords2.includes(w.word)) {
              appearedWords2 = appearedWords2.filter(word => word !== w.word);
              localStorage.setItem('appearedWords', JSON.stringify(appearedWords2));
            }
          } else {
            document.getElementById('feedback').textContent = 'טעות. התשובה הנכונה: ' + w.correct;
          }
          document.getElementById('score').textContent = 'ניקוד: ' + score;
          setTimeout(() => {
            current++;
            showQuestion();
          }, 1000);
        };
        optionsDiv.appendChild(btn);
      });
      // הוסף כפתור "לא יודע"
      const dontKnowBtn = document.createElement('button');
      dontKnowBtn.textContent = 'לא יודע';
      dontKnowBtn.className = 'option';
      dontKnowBtn.style.backgroundColor = '#ffe0e0';
      dontKnowBtn.onclick = () => {
        let appearedWords3 = JSON.parse(localStorage.getItem('appearedWords') || '[]');
        if (!appearedWords3.includes(w.word)) {
          appearedWords3.push(w.word);
          localStorage.setItem('appearedWords', JSON.stringify(appearedWords3));
        }
        document.getElementById('feedback').textContent = 'התשובה הנכונה: ' + w.correct;
        setTimeout(() => {
          current++;
          showQuestion();
        }, 1200);
      };
      optionsDiv.appendChild(dontKnowBtn);
      // חיצים לניווט
      document.getElementById('prev-btn').onclick = () => {
        if (current > 0) {
          current--;
          showQuestion();
        }
      };
      document.getElementById('next-btn').onclick = () => {
        if (current < words.length - 1) {
          current++;
          showQuestion();
        }
      };
      document.getElementById('prev100-btn').onclick = () => {
        current = Math.max(0, current - 100);
        showQuestion();
      };
      document.getElementById('next100-btn').onclick = () => {
        current = Math.min(words.length - 1, current + 100);
        showQuestion();
      };
      updateVersionIndicator();
    }

    // בדיקת חיבור ל-Firebase
    window.testFirebaseConnection = async function() {
      try {
        await auth.signInAnonymously(); // ניסיון התחברות אנונימית
        alert('חיבור ל-Firebase בוצע בהצלחה! ניתן להתחבר באמצעות פונקציות הרשמה/התחברות.');
        await signOut(auth); // יציאה מהחיבור האנונימי
      } catch (error) {
        alert(`חיבור ל-Firebase נכשל: ${error.message}\nנסה לבדוק את חיבור האינטרנט או לפתוח את האפליקציה בשרת מקומי.`);
      }
    }

  fetch('words_quiz_he.json')
    .then(response => response.json())
    .then(data => {
      quizWords = data;
      words = [...quizWords];
      showQuestion();
    })
    .catch(error => {
      document.getElementById('main-content').textContent = 'שגיאה בטעינת החידון';
      console.error('Error loading JSON:', error);
    });
  </script>
</body>
</html>
